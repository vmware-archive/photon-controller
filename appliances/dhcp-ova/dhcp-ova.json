{
  "builders": [
    {
      "type": "virtualbox-ovf",
      "format": "ova",
      "source_path": "{{ user `photon_ova_url` }}",
      "vm_name": "dhcp-ova-virtualbox",
      "ssh_username": "root",
      "ssh_password": "vmware",
      "guest_additions_mode": "disable",
      "shutdown_command": "shutdown -P now",
      "headless": true,
      "output_directory": "build/"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": "mkdir -p /usr/local/sbin && wget -nv {{ user `dnsmasq_url` }} -O /usr/local/sbin/dnsmasq && chmod +x /usr/local/sbin/dnsmasq"
    },
    {
      "type": "shell",
      "inline": "wget -nv {{ user `dnsmasq_dhcp_release_url` }} -O /usr/local/bin/dhcp_release && chmod +x /usr/local/bin/dhcp_release"
    },
    {
      "type": "shell",
      "inline": "rm /etc/systemd/network/*"
    },
    {
      "type": "shell",
      "inline": "systemctl restart systemd-networkd"
    },
    {
      "type": "shell",
      "script": "./configure-user.sh"
    },
    {
      "type": "shell",
      "script": "../scripts/sshd-config.sh",
      "environment_vars": [ "SSHD_ENABLE_ROOT_LOGIN={{ user `sshd_enable_root_login` }}" ]
    },
    {
      "type": "shell",
      "inline": "systemctl restart sshd"
    }
  ]
}
