// This does not build the actual agent, but instead provides Gradle tasks
// for building the agent inside of a running devbox via Vagrant plugin.
import com.bmuschko.gradle.vagrant.tasks.VagrantSsh

// TODO: change from being agent to being all devbox tasks
ext {
  virtualBoxDir = file('../../devbox-photon')
}

task buildVib(type: VagrantSsh) {
  description = 'Build agent VIB inside devbox'
  boxDir = virtualBoxDir
  sshCommand = '$HOME/build-agent-vib.sh 2>&1 | tee -a $HOME/build-agent-vib.log'
}

task start(type: VagrantSsh) {
  description = 'Start agent inside devbox'
  boxDir = virtualBoxDir
  sshCommand = '$HOME/start-agent.sh 2>&1 | tee -a $HOME/start-agent.log'
}

task stop(type: VagrantSsh) {
  description = 'Stop agent inside devbox'
  boxDir = virtualBoxDir
  sshCommand = '$HOME/stop-agent.sh 2>&1 | tee -a $HOME/stop-agent.log'
}

task restart() {
  dependsOn stop
  finalizedBy start
}

build.dependsOn buildVib
