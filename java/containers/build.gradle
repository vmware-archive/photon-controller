import com.bmuschko.gradle.docker.tasks.container.*
import com.bmuschko.gradle.docker.tasks.image.*

task servicebase(type: DockerBuildImage) {
  inputDir = file("servicebase")
  tag = "photon/servicebase"
}

task haproxy(type: DockerBuildImage) {
  dependsOn servicebase
  inputDir = file("haproxy")
  tag = "photon/haproxy"
}

task zookeeper(type: DockerBuildImage) {
  dependsOn servicebase
  inputDir = file("zookeeper")
  tag = "photon/zookeeper"
}

task removeZookeeper(type: DockerRemoveImage) {
  targetImageId { zookeeper.tag }
}

task removeHaproxy(type: DockerRemoveImage) {
  targetImageId { haproxy.tag }
}

task removeServicebase(type: DockerRemoveImage) {
  targetImageId { servicebase.tag }
}

build.dependsOn(
  zookeeper,
  haproxy,
  ":chairman:container",
  ":cloud-store:container",
  ":deployer:container",
  ":housekeeper:container",
  ":root-scheduler:container"
)

clean.dependsOn(
  ":chairman:removeContainer",
  ":cloud-store:removeContainer",
  ":deployer:removeContainer",
  ":housekeeper:removeContainer",
  ":root-scheduler:removeContainer",
  removeZookeeper,
  removeHaproxy,
  removeServicebase
)
